# 升级说明

## 单机模式

- [数据备份](https://docs.pd.mingdao.com/docker-compose-standalone-data.html)

- 明道云微服务应用升级到 `v1.6.0`，参考 [单机模式微服务应用镜像升级](https://docs.pd.mingdao.com/docker-compose-standalone-upgrade.html#%E6%98%8E%E9%81%93%E4%BA%91%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E9%95%9C%E5%83%8F%E5%8D%87%E7%BA%A7)，如果需要使用到数据存储路径自定义功能，则需要 [升级安装管理器](https://docs.pd.mingdao.com/docker-compose-standalone-upgrade.html#%E5%AE%89%E8%A3%85%E7%AE%A1%E7%90%86%E5%99%A8%E5%8D%87%E7%BA%A7)

- 镜像升级完成后进入明道云微服务应用容器内执行数据库调整脚本，具体步骤如下：
  
  1. 进入容器：docker exec -it  \`docker ps | grep mingdaoyun-community | awk '{print $1}'\` bash

  2. 连接 mongodb 数据库 ：`/init/mongodb/mongo` 

  3. 执行 [脚本](https://github.com/mingdaocom/private-deployment/tree/master/docs/upgrade/1.6.0/db/mongodb/DDL.sql) ，添加索引


## 集群模式

- 对数据存储相关服务器的数据目录进行备份

- 明道云微服务应用升级到 `v1.6.0`，参考 [集群模式微服务应用镜像升级](https://docs.pd.mingdao.com/docker-compose-cluster-upgrade.html#%E6%98%8E%E9%81%93%E4%BA%91%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E9%95%9C%E5%83%8F%E5%8D%87%E7%BA%A7)

- 镜像升级完成后进入明道云微服务应用容器内执行数据库调整脚本，具体步骤如下：
  
  1. 进入容器：docker exec -it  \`docker ps | grep mingdaoyun-community | awk '{print $1}'\` bash

  2. 连接 mongodb 数据库 ：`/init/mongodb/mongo ${ENV_MONGODB_URI%%,*}` 

  3. 执行 [脚本](https://github.com/mingdaocom/private-deployment/tree/master/docs/upgrade/1.6.0/db/mongodb/DDL.sql) ，添加索引